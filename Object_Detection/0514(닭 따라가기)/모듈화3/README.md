# 닭 객체 ID 추적 시스템 (간소화 버전)

## 개요
이 프로젝트는 기존 '모듈화2'의 코드에서 ID 관리 메커니즘 부분을 중점으로 가볍게 재구현한 버전입니다. 불필요한 기능을 제거하고 객체 ID 추적에 집중하여 성능을 최적화했습니다.

## 주요 기능
- YOLO 기반 닭 객체 탐지 (자동 활성화)
- 객체 ID 연속성 유지 및 추적 (항상 활성화)
- 영상의 특정 시간 범위 및 관심 영역(ROI) 설정 가능
- 재생 속도 및 탐지 간격 조절 기능
- 단순화된 키보드 컨트롤 (ESC: 종료, a: 뒤로 이동, d: 앞으로 이동)

## 파일 구조

### ChickenDetector.py
YOLO 모델을 사용하여 닭을 감지하고 ID를 추적하는 클래스입니다.

- **주요 데이터 구조**:
  - `chicken_id_sets`: 같은 닭으로 판단된 ID의 집합들
  - `id_to_set_index`: ID가 어느 집합에 속하는지 매핑
  - `id_to_position`: ID별 위치 정보
  - `set_to_display_id`: 각 ID 집합의 대표 ID

- **핵심 알고리즘**:
  - `_update_id_mapping()`: ID 매핑 정보 업데이트
  - `_modify_results_with_mapped_ids()`: 일관된 ID로 결과 수정
  - `_clean_up_stale_data()`: 오래된 데이터 정리

### VideoPlayer.py
비디오를 재생하고 닭 객체 탐지 결과를 시각화하는 클래스입니다.

- **주요 기능**:
  - `set_video_range()`: 영상의 특정 시간 구간만 분석하도록 설정
  - `set_frame_roi()`: 프레임 내 관심 영역(ROI)을 설정
  - `detect_chickens()`: 프레임에서 닭 객체 탐지
  - `_draw_id_text_with_background()`: ID 텍스트 시각화

### main.py
프로그램의 진입점으로, VideoPlayer를 생성하고 실행합니다.

## 사용 방법

### 기본 실행
```python
python main.py
```

### 키보드 조작법
- **ESC**: 프로그램 종료
- **'a'**: 5초 뒤로 이동
- **'d'**: 5초 앞으로 이동

### 성능 최적화 옵션
main.py 파일에서 다음 설정을 조정할 수 있습니다:

1. **탐지 간격 설정**
```python
# 몇 프레임마다 탐지할지 설정 (높을수록 성능 향상)
detection_interval = 15  # 15프레임마다 닭 탐지
```

2. **재생 속도 설정**
```python
# 재생 속도 설정 (1.0이 기본 속도, 높을수록 빠름)
player.set_playback_speed(speed_factor=1.5)  # 1.5배 빠르게 재생
```

3. **영상 축소 비율 설정** 
```python
# 화면에 표시될 영상 크기 비율 (작을수록 성능 향상)
scale_factor = 0.8  # 원본 대비 80% 크기로 표시
```

### 영상 분석 범위 및 ROI 설정
main.py 파일에서 다음 설정을 조정할 수 있습니다:

1. **시간 범위 설정**
```python
# 영상 분석 시간 범위 설정 (초 단위)
player.set_video_range(start_time=10, end_time=40)  # 10초~40초 구간만 분석
```

2. **관심 영역(ROI) 설정**
```python
# 프레임 ROI(관심 영역) 설정
player.set_frame_roi(x1=100, y1=50, x2=800, y2=600)
```

### 키보드 단축키
- `q`: 종료
- `스페이스바`: 재생/일시정지
- `a`: 뒤로 5초
- `d`: 앞으로 5초

## 최적화 포인트
1. 그리드 분할 기능 제거
2. 불필요한 옵션 설정 제거 (YOLO 탐지, 객체 추적, ID 일관성은 항상 켜짐)
3. 제곱 거리 계산을 통한 연산 최적화
4. 오래된 ID 정리를 통한 메모리 관리
5. 영상의 특정 구간만 분석 가능